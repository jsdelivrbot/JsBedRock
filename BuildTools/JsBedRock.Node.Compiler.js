!function(){new JsBedRock.Assemblies.AssemblyDef({Name:"JsBedRock.Node.Compiler",Dependencies:[new JsBedRock.Assemblies.AssemblyDependency({Name:"JsBedRock.Node.IO"}),new JsBedRock.Assemblies.AssemblyDependency({Name:"JsBedRock.Node"}),new JsBedRock.Assemblies.AssemblyDependency({Name:"JsBedRock.Core"})],NodeDependencies:[]})}(),JsBedRock.Compiler=JsBedRock.Compiler||{},function(e){e.OnLoad(function(){JsBedRock.Compiler.SettingResolver=JsBedRock.Utils.ObjectOriented.CreateClass({Constructor:function(e,t){JsBedRock.Utils.ObjectOriented.CallBaseConstructor(this,JsBedRock.Types.Object)},Members:{ResolveSolutionSetting:{Def:function(e,t){return t.replace(/{{.*?}}/g,function(t){return e[t.substring(2,t.length-2)]})}},ResolveProjectSetting:{Def:function(e,t){return t.replace(/{{.*?}}/g,function(t){var o=t.substring(2,t.length-2);switch(o){case"Dependencies":for(var s=e[o],i="",r=0;r<s.length;r++)i+="new JsBedRock.Assemblies.AssemblyDependency({ Name: '"+s[r]+"' }),";return i.substring(0,i.length-1);case"NodeDependencies":var s=e[o],i="";if(s)for(var r=0;r<s.length;r++)i+='"'+s[r]+'",';return JsBedRock.Utils.String.IsEmptyOrSpaces(i)?JsBedRock.Utils.String.Empty:i.substring(0,i.length-1);case"OutputFileName":return require("path").basename(e.OutputFile);default:return e[o]}})}}}})})}(JsBedRock.CurrentAssembly),JsBedRock.Compiler=JsBedRock.Compiler||{},function(e){e.OnLoad(function(){JsBedRock.Compiler.TempFile=JsBedRock.Utils.ObjectOriented.CreateClass({Constructor:function(e){this.__FileSystem=new JsBedRock.Node.IO.FileSystem,this.__FileName=this.__CreateFileName(),this._WriteFile(e),JsBedRock.Utils.ObjectOriented.CallBaseConstructor(this,JsBedRock.Types.Object)},Members:{_WriteFile:{Def:function(e){this.__FileSystem.WriteFileSync(this.__FileName,e)}},_CleanUpFile:{Def:function(){this.__FileSystem.DeleteSync(this.__FileName)}},GetFileName:{Def:function(){return this.__FileName}},__CreateFileName:{Def:function(){return __dirname+"/"+(Math.random().toString(36)+"00000000000000000").slice(2,12)+".temp"}},__FileSystem:{Def:null},__FileName:{Def:null}}})})}(JsBedRock.CurrentAssembly),JsBedRock.Compiler=JsBedRock.Compiler||{},function(e){e.OnLoad(function(){JsBedRock.Compiler.ProjectTypes={Assets:"Assets",Flat:"Flat",ClassLibrary:"ClassLibrary",TestRunner:"TestRunner",BrowserExecutable:"BrowserExecutable",NodeExecutable:"NodeExecutable",NodeInstallerExecutable:"NodeInstallerExecutable",VSCodeExtension:"VSCodeExtension"}})}(JsBedRock.CurrentAssembly),JsBedRock.Compiler=JsBedRock.Compiler||{},function(e){e.OnLoad(function(){JsBedRock.Compiler.ProjectCompilerBase=JsBedRock.Utils.ObjectOriented.CreateClass({Constructor:function(e,t,o,s){this.__Uglifyjs=require("uglify-js"),this.__Path=require("path"),this.__SettingResolver=new JsBedRock.Compiler.SettingResolver,this._SolutionData=e,this._SolutionDir=this.__Path.dirname(t),this._ProjectData=o,this._ProjectDir=this.__Path.dirname(s),this._ProjectData&&(this._OutputFile=this.__Path.join(this._ProjectDir,this.__SettingResolver.ResolveSolutionSetting(this._SolutionData,this._ProjectData.OutputFile))),JsBedRock.Utils.ObjectOriented.CallBaseConstructor(this,JsBedRock.Types.Object)},Members:{CompileProject:{Def:function(){for(var e=this._GetSourceFiles(),t=0;t<e.length;t++)this._LintFile(e[t]);this._WriteOutputFile(this.__Uglifyjs.minify(e,this._GetUglifyJsOptions()))}},_GetSourceFiles:{Def:function(){for(var e=[],t=0;t<this._ProjectData.SourceFiles.length;t++)e.push(this.__Path.join(this._ProjectDir,this._ProjectData.SourceFiles[t]));return e}},_LintFile:{Def:function(e){var t=require("jshint").JSHINT;t((new JsBedRock.Node.IO.FileSystem).ReadFileSync(e).toString(),{undef:!0},{JsBedRock:!0});var o=t.data();o&&o.errors&&o.errors.length>0}},_WriteOutputFile:{Def:function(e){this._EnsureDirectoryExists(this.__Path.dirname(this._OutputFile)),JsBedRock.Utils.String.IsEmptyOrSpaces(this._OutputFile)||((new JsBedRock.Node.IO.FileSystem).WriteFileSync(this._OutputFile,e.code),(new JsBedRock.Node.IO.FileSystem).WriteFileSync(this._OutputFile+".map",e.map))}},_EnsureDirectoryExists:{Def:function(e){var t=e.split(this.__Path.sep);t.length>1&&(t.pop(),this._EnsureDirectoryExists(t.join(this.__Path.sep))),(new JsBedRock.Node.IO.FileSystem).DirectoryExistsSync(e)||(new JsBedRock.Node.IO.FileSystem).MkDirSync(e)}},_GetSdkLocation:{Def:function(){return JsBedRock.Utils.String.IsEmptyOrSpaces(this._SolutionData.SDKLocationOverride)?__dirname+"/../../":this.__SettingResolver.ResolveSolutionSetting(this._SolutionData,this._SolutionData.SDKLocationOverride)}},_GetUglifyJsOptions:{Def:function(){var e={outSourceMap:this._OutputFile+".map"};return"DebugSourceRoot"in this._ProjectData&&(e.sourceRoot=this._ProjectData.DebugSourceRoot),e}},_SolutionData:{Def:null},_SolutionDir:{Def:null},_ProjectData:{Def:null},_ProjectDir:{Def:null},_OutputFile:{Def:null},__Path:{Def:null},__Uglifyjs:{Def:null}},Name:"ProjectCompilerBase"})})}(JsBedRock.CurrentAssembly),JsBedRock.Compiler=JsBedRock.Compiler||{},function(e){e.OnLoad(function(){JsBedRock.Utils.ObjectOriented.CreateClass({Inherit:JsBedRock.Compiler.ProjectCompilerBase,Constructor:JsBedRock.Compiler.AssemblyProjectCompilerBase=function(e,t,o,s){JsBedRock.Utils.ObjectOriented.CallBaseConstructor(this,JsBedRock.Compiler.ProjectCompilerBase,e,t,o,s)},Members:{CompileProject:{Def:function(){var e=(new JsBedRock.Node.IO.FileSystem).ReadFileSync(this._GetSdkLocation(this._SolutionData)+"AssemblyWrappers/AsmConfig.js").toString();this.__AsmConfigTempFile=new JsBedRock.Compiler.TempFile(this._ResolveAsmConfig(e)),this.Base(),this.__AsmConfigTempFile._CleanUpFile()}},_GetSourceFiles:{Def:function(){var e=this.Base();return e.unshift(this.__AsmConfigTempFile.GetFileName()),e}},_ResolveAsmConfig:{Def:function(e){return this.__SettingResolver.ResolveProjectSetting(this._ProjectData,e)}},__AsmConfigTempFile:{Def:null}},Name:"AssemblyProjectCompilerBase"})})}(JsBedRock.CurrentAssembly),JsBedRock.Compiler=JsBedRock.Compiler||{},function(e){e.OnLoad(function(){JsBedRock.Utils.ObjectOriented.CreateClass({Inherit:JsBedRock.Compiler.AssemblyProjectCompilerBase,Constructor:JsBedRock.Compiler.ExecutableProjectCompilerBase=function(e,t,o,s){JsBedRock.Utils.ObjectOriented.CallBaseConstructor(this,JsBedRock.Compiler.AssemblyProjectCompilerBase,e,t,o,s)},Members:{CompileProject:{Def:function(){this.Base(),this._CopyDependencies(),this._CopyConfig()}},_GetSourceFiles:{Def:function(){var e=this.Base();return e.unshift(this._GetSdkLocation(this._SolutionData)+"JsBedRock.Framework.js"),e}},_CopyDependencies:{Def:function(){for(var e=this.__Path.dirname(this._OutputFile),t=0;t<this._ProjectData.Dependencies.length;t++)for(var o=0;o<this._SolutionData.Projects.length;o++){var s=this.__Path.join(this._SolutionDir,this.__SettingResolver.ResolveSolutionSetting(this._SolutionData,this._SolutionData.Projects[o])),i=JSON.parse((new JsBedRock.Node.IO.FileSystem).ReadFileSync(s).toString());if(this._ProjectData.Dependencies[t]===i.Name){var r=e+"/"+this._ProjectData.Dependencies[t]+".js";(new JsBedRock.Node.IO.FileSystem).CopyFile(this.__Path.join(this.__Path.dirname(s),this.__SettingResolver.ResolveSolutionSetting(this._SolutionData,i.OutputFile)),r)}}}},_CopyConfig:{Def:function(){(new JsBedRock.Node.IO.FileSystem).CopyFile(this._ProjectDir+"/config.json",this.__Path.dirname(this._OutputFile)+"/config.json")}}},Name:"ExecutableProjectCompilerBase"})})}(JsBedRock.CurrentAssembly),JsBedRock.Compiler=JsBedRock.Compiler||{},function(e){e.OnLoad(function(){JsBedRock.Utils.ObjectOriented.CreateClass({Inherit:JsBedRock.Compiler.ProjectCompilerBase,Constructor:JsBedRock.Compiler.AssetProjectCompiler=function(e,t,o,s){JsBedRock.Utils.ObjectOriented.CallBaseConstructor(this,JsBedRock.Compiler.ProjectCompilerBase,e,t,o,s)},Members:{CompileProject:{Def:function(){for(var e=0;e<this._ProjectData.SourceFiles.length;e++){var t=this.__Path.join(this._OutputFile,this._ProjectData.SourceFiles[e]);this._EnsureDirectoryExists(this.__Path.dirname(t)),(new JsBedRock.Node.IO.FileSystem).CopyFile(this.__Path.join(this._ProjectDir,this._ProjectData.SourceFiles[e]),t)}}}},Name:"AssetProjectCompiler"})})}(JsBedRock.CurrentAssembly),JsBedRock.Compiler=JsBedRock.Compiler||{},function(e){e.OnLoad(function(){JsBedRock.Utils.ObjectOriented.CreateClass({Inherit:JsBedRock.Compiler.ExecutableProjectCompilerBase,Constructor:JsBedRock.Compiler.BrowserExecutableProjectCompiler=function(e,t,o,s){JsBedRock.Utils.ObjectOriented.CallBaseConstructor(this,JsBedRock.Compiler.ExecutableProjectCompilerBase,e,t,o,s)},Members:{CompileProject:{Def:function(){this.Base(),this._CreateHtmlIndexFile()}},_GetSourceFiles:{Def:function(){var e=this.Base();return e.push(this._GetSdkLocation(this._SolutionData)+"AssemblyWrappers/"+JsBedRock.Compiler.ProjectTypes.BrowserExecutable+".js"),e}},_CopyDependencies:{Def:function(){for(var e=this.__Path.dirname(this._OutputFile),t=0;t<this._ProjectData.Dependencies.length;t++){var o=this._GetSdkLocation(this._SolutionData)+"../"+this._ProjectData.Dependencies[t]+".js",s=e+"/"+this._ProjectData.Dependencies[t]+".js";(new JsBedRock.Node.IO.FileSystem).FileExistsSync(o)&&(new JsBedRock.Node.IO.FileSystem).CopyFile(o,s)}this.Base()}},_CreateHtmlIndexFile:{Def:function(){var e=(new JsBedRock.Node.IO.FileSystem).ReadFileSync(this._GetSdkLocation(this._SolutionData)+"AssemblyAssets/BrowserExecutable/index.html").toString(),t=new JsBedRock.Compiler.TempFile(this._ResolveHtmlTemplate(e));(new JsBedRock.Node.IO.FileSystem).CopyFile(t.GetFileName(),this.__Path.dirname(this._OutputFile)+"/index.html"),t._CleanUpFile()}},_ResolveHtmlTemplate:{Def:function(e){return(new JsBedRock.Compiler.SettingResolver).ResolveProjectSetting(this._ProjectData,e)}}},Name:"BrowserExecutableProjectCompiler"})})}(JsBedRock.CurrentAssembly),JsBedRock.Compiler=JsBedRock.Compiler||{},function(e){e.OnLoad(function(){JsBedRock.Utils.ObjectOriented.CreateClass({Inherit:JsBedRock.Compiler.AssemblyProjectCompilerBase,Constructor:JsBedRock.Compiler.ClassLibraryProjectCompiler=function(e,t,o,s){JsBedRock.Utils.ObjectOriented.CallBaseConstructor(this,JsBedRock.Compiler.AssemblyProjectCompilerBase,e,t,o,s)},Members:{_GetSourceFiles:{Def:function(){var e=this.Base();return e.push(this._GetSdkLocation(this._SolutionData)+"AssemblyWrappers/"+JsBedRock.Compiler.ProjectTypes.ClassLibrary+".js"),e}}},Name:"ClassLibraryProjectCompiler"})})}(JsBedRock.CurrentAssembly),JsBedRock.Compiler=JsBedRock.Compiler||{},function(e){e.OnLoad(function(){JsBedRock.Utils.ObjectOriented.CreateClass({Inherit:JsBedRock.Compiler.ExecutableProjectCompilerBase,Constructor:JsBedRock.Compiler.NodeExecutableProjectCompiler=function(e,t,o,s){JsBedRock.Utils.ObjectOriented.CallBaseConstructor(this,JsBedRock.Compiler.ExecutableProjectCompilerBase,e,t,o,s)},Members:{_GetSourceFiles:{Def:function(){var e=this.Base();return e.push(this._GetSdkLocation(this._SolutionData)+"AssemblyWrappers/"+JsBedRock.Compiler.ProjectTypes.NodeExecutable+".js"),e}}},Name:"NodeExecutableProjectCompiler"})})}(JsBedRock.CurrentAssembly),JsBedRock.Compiler=JsBedRock.Compiler||{},function(e){e.OnLoad(function(){JsBedRock.Utils.ObjectOriented.CreateClass({Inherit:JsBedRock.Compiler.NodeExecutableProjectCompiler,Constructor:JsBedRock.Compiler.NodeInstallerExecutableProjectCompiler=function(e,t,o,s){this._Fs=new JsBedRock.Node.IO.FileSystem,JsBedRock.Utils.ObjectOriented.CallBaseConstructor(this,JsBedRock.Compiler.NodeExecutableProjectCompiler,e,t,o,s)},Members:{CompileProject:{Def:function(){this.Base(),this._BuildContentArchive()}},_BuildContentArchive:{Def:function(){var e=require("fstream"),t=require("tar"),o=this._Fs.CreateWriteStream(this.__Path.dirname(this._OutputFile)+"/Content.tar"),s=t.Pack({noProprietary:!0});e.Reader({path:this.__Path.join(this._ProjectDir,this.__SettingResolver.ResolveSolutionSetting(this._SolutionData,this._ProjectData.InstallContentDirectory)),type:"Directory"}).pipe(s).pipe(o)}},_Fs:{Def:null}},Name:"NodeInstallerExecutableProjectCompiler"})})}(JsBedRock.CurrentAssembly),JsBedRock.Compiler=JsBedRock.Compiler||{},function(e){e.OnLoad(function(){JsBedRock.Utils.ObjectOriented.CreateClass({Inherit:JsBedRock.Compiler.ExecutableProjectCompilerBase,Constructor:JsBedRock.Compiler.TestRunnerProjectCompiler=function(e,t,o,s){this.__ChildProcess=require("child_process"),JsBedRock.Utils.ObjectOriented.CallBaseConstructor(this,JsBedRock.Compiler.ExecutableProjectCompilerBase,e,t,o,s)},Members:{CompileProject:{Def:function(){this.Base(),this.__ExecuteUnitTests(this._ProjectData)}},_GetSourceFiles:{Def:function(){var e=this.Base();return e.push(this._GetSdkLocation(this._SolutionData)+"AssemblyWrappers/"+JsBedRock.Compiler.ProjectTypes.TestRunner+".js"),e}},__ExecuteUnitTests:{Def:function(e){this.__ChildProcess.exec(JsBedRock.AppConfig.NodeConfig.NodeExecutable+" "+this._OutputFile,function(e,t,o){if(e)throw JsBedRock.Console.Write(e.stack),JsBedRock.Console.Write("Error code: "+e.code),JsBedRock.Console.Write("Signal received: "+e.signal),e;JsBedRock.Utils.String.IsEmptyOrSpaces(t)||JsBedRock.Console.Write("Child Process STDOUT: "+t),JsBedRock.Utils.String.IsEmptyOrSpaces(o)||JsBedRock.Console.Write("Child Process STDERR: "+o)})}},__ChildProcess:{Def:null}},Name:"TestRunnerProjectCompiler"})})}(JsBedRock.CurrentAssembly),JsBedRock.Compiler=JsBedRock.Compiler||{},function(e){e.OnLoad(function(){JsBedRock.Utils.ObjectOriented.CreateClass({Inherit:JsBedRock.Compiler.ExecutableProjectCompilerBase,Constructor:JsBedRock.Compiler.VSCodeExtensionProjectCompiler=function(e,t,o,s){JsBedRock.Utils.ObjectOriented.CallBaseConstructor(this,JsBedRock.Compiler.ExecutableProjectCompilerBase,e,t,o,s)},Members:{_GetSourceFiles:{Def:function(){var e=this.Base();return e.push(this._GetSdkLocation(this._SolutionData)+"AssemblyWrappers/"+JsBedRock.Compiler.ProjectTypes.VSCodeExtension+".js"),e}}},Name:"VSCodeExtensionProjectCompiler"})})}(JsBedRock.CurrentAssembly),JsBedRock.Compiler=JsBedRock.Compiler||{},function(e){e.OnLoad(function(){JsBedRock.Compiler.Compiler=JsBedRock.Utils.ObjectOriented.CreateClass({Constructor:function(){this.__Path=require("path"),JsBedRock.Utils.ObjectOriented.CallBaseConstructor(this,JsBedRock.Types.Object)},Members:{BuildSolution:{Def:function(e){var t=new JsBedRock.Compiler.SettingResolver,o=this.__Path.dirname(e),s=e,i=JSON.parse((new JsBedRock.Node.IO.FileSystem).ReadFileSync(s).toString());try{for(var r=0;r<i.Projects.length;r++){var n=this.__Path.join(o,t.ResolveSolutionSetting(i,i.Projects[r])),c=JSON.parse((new JsBedRock.Node.IO.FileSystem).ReadFileSync(n).toString()),l=this.ProjectCompilerFactory(i,s,c,n);l.CompileProject()}}catch(a){throw JsBedRock.Console.Write(JsBedRock.Console.Dump(a)),a}}},ProjectCompilerFactory:{Def:function(e,t,o,s){switch(o.ProjectType){case JsBedRock.Compiler.ProjectTypes.Assets:return new JsBedRock.Compiler.AssetProjectCompiler(e,t,o,s);case JsBedRock.Compiler.ProjectTypes.BrowserExecutable:return new JsBedRock.Compiler.BrowserExecutableProjectCompiler(e,t,o,s);case JsBedRock.Compiler.ProjectTypes.ClassLibrary:return new JsBedRock.Compiler.ClassLibraryProjectCompiler(e,t,o,s);case JsBedRock.Compiler.ProjectTypes.NodeExecutable:return new JsBedRock.Compiler.NodeExecutableProjectCompiler(e,t,o,s);case JsBedRock.Compiler.ProjectTypes.NodeInstallerExecutable:return new JsBedRock.Compiler.NodeInstallerExecutableProjectCompiler(e,t,o,s);case JsBedRock.Compiler.ProjectTypes.TestRunner:return new JsBedRock.Compiler.TestRunnerProjectCompiler(e,t,o,s);case JsBedRock.Compiler.ProjectTypes.VSCodeExtension:return new JsBedRock.Compiler.VSCodeExtensionProjectCompiler(e,t,o,s);default:return new JsBedRock.Compiler.ProjectCompilerBase(e,t,o,s)}}},__Path:{Def:null}}})})}(JsBedRock.CurrentAssembly),function(e){JsBedRock.Assemblies.GlobalAssemblyCache.RegisterAssembly(e)}(JsBedRock.CurrentAssembly);
//# sourceMappingURL=bin/0.16.02/JsBedRock.Node.Compiler.js.map